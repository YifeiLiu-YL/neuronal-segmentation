## Step 1. Default Segmentation with Cellpose-SAM

Apply Cellpose-SAM to all images as the initial segmentation step.

- No manual training is performed
- Default or minimally adjusted parameters are used
- Cellpose-SAM serves as a zero-shot baseline

Output:
- Segmentation masks generated by Cellpose-SAM


## Step 2. Compare with Human Expectation

Visually inspect the Cellpose-SAM output and compare it with qualitative
human expectation.

This step focuses on identifying obvious under-detection, defined as cases where neurons visible to the human eye are missing from the segmentation output.

Notes:
- Boundary mismatch is acceptable
- Minor over-segmentation is acceptable
- Missing identifiable neurons is not acceptable

If the Cellpose-SAM output reasonably captures all identifiable neurons, it may be accepted without further processing.


## Step 3. Apply Cellpose 3 for Comparison (If Needed)

If Cellpose-SAM output shows clear under-detection, apply Cellpose 3 to the same images.

- Cellpose 3 is used here as a comparison method
- No assumption is made that Cellpose 3 will always outperform Cellpose-SAM
- Training is not required at this stage

Output:
- Segmentation masks generated by Cellpose 3


## Step 4. Select the More Correct Output

Compare Cellpose-SAM and Cellpose 3 outputs based on correctness.

Correctness is defined as:
- Better coverage of neurons identifiable by human inspection
- Not boundary precision or pixel-level accuracy

Decision:
- Select the output that best matches human-identifiable neurons
- If both outputs are comparable, preference may be given to Cellpose-SAM


## Step 5. Manual Correction

Perform manual correction on the selected segmentation output.

Manual correction may include:
- Adding missed neurons
- Removing obvious false positives
- Fixing gross segmentation errors

Precise boundary refinement is optional and not required.

The corrected masks are treated as ground truth for subsequent training.


## Step 6. Collect Training Data

Store manually corrected masks as training data for Cellpose 3.

For each training sample, record:
- Original image
- Initial segmentation method (Cellpose-SAM or Cellpose 3)
- Reason for fallback, if applicable (e.g. under-detection)
- Corrected segmentation mask

Training data collection is incremental and ongoing.


## Step 7. Train Cellpose 3 (Periodic)

Train Cellpose 3 periodically using accumulated training data.

- Training is performed after sufficient corrected examples are collected
- Training focuses on cases where under-detection previously occurred
- The goal is to reduce future manual correction

Training frequency and dataset size may be adjusted based on project needs.


## Step 8. Iterate and Update Workflow

After training:
- Apply the updated Cellpose 3 model to relevant images
- Evaluate whether manual correction is reduced

For specific datasets or phenotypes:
- Cellpose 3 may be used as the primary segmentation method
- Cellpose-SAM may remain the default for others

The workflow is expected to evolve as more data is collected.


## Notes

This workflow intentionally incorporates qualitative human judgment. Quantitative thresholds and metrics may be introduced in future revisions, but are not required to apply the current protocol.
