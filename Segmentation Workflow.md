# Segmentation Workflow

## Step 1. Default Segmentation with Cellpose-SAM

Apply [Cellpose-SAM](https://github.com/YifeiLiu-YL/neuronal-segmentation/blob/main/Cellpose%20SAM%20Workbook.pdf) to all images as the initial segmentation step.

- No manual training is performed
- Default or minimally adjusted parameters are used
- Cellpose-SAM serves as a zero-shot baseline

Output:
- Segmentation masks generated by Cellpose-SAM


## Step 2. Compare with Human Expectation

Visually inspect the Cellpose-SAM output and compare it with qualitative
human expectation.

This step focuses on identifying obvious under-detection, defined as cases where neurons visible to the human eye are missing from the segmentation output.

Notes:
- Boundary mismatch is acceptable
- Minor over-segmentation is acceptable
- Missing identifiable neurons is not acceptable

If the Cellpose-SAM output reasonably captures all identifiable neurons, it may be accepted without further processing.


## Step 3. Apply Cellpose 3 for Comparison (If Needed)

If Cellpose-SAM output shows clear under-detection, apply [Cellpose3](https://github.com/YifeiLiu-YL/neuronal-segmentation/blob/main/cellpose3.md) to the same images.

- Cellpose 3 is used here as a comparison method
- No assumption is made that Cellpose 3 will always outperform Cellpose-SAM
- Training is not required at this stage

Output:
- Segmentation masks generated by Cellpose 3


## Step 4. Select the More Correct Output

Compare Cellpose-SAM and Cellpose 3 outputs based on correctness.

Correctness is defined as:
- Better coverage of neurons identifiable by human inspection
- Not boundary precision or pixel-level accuracy

Decision:
- Select the output that best matches human-identifiable neurons
- If both outputs are comparable, preference may be given to Cellpose-SAM


## Step 5. Train Cellpose 3

Train Cellpose 3 periodically using accumulated training data.

- Training is performed after sufficient corrected examples are collected
- Training focuses on cases where under-detection previously occurred
- The goal is to reduce future manual correction

Training frequency and dataset size may be adjusted based on project needs.


## Step 6. Iterate and Update Workflow

After training:
- Apply the updated Cellpose 3 model to relevant images
- Evaluate whether manual correction is reduced

For specific datasets or phenotypes:
- Cellpose 3 may be used as the primary segmentation method
- Cellpose-SAM may remain the default for others

The workflow is expected to evolve as more data is collected.


## Notes

This workflow intentionally incorporates qualitative human judgment. Quantitative thresholds and metrics may be introduced in future revisions, but are not required to apply the current protocol.
